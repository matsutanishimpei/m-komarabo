<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>困りごと詳細 - 困りごとラボ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 min-h-screen p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <div class="mb-6">
            <a href="index.html" class="text-blue-500 hover:text-blue-700 text-sm font-medium">← ダッシュボードに戻る</a>
        </div>

        <div id="loading" class="text-center py-20 text-slate-400">読み込み中...</div>

        <div id="detail-content" class="hidden">
            <div id="status-badge"
                class="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-4"></div>
            <h1 id="title" class="text-3xl font-bold text-slate-800 mb-4"></h1>
            <p id="description" class="text-slate-600 leading-relaxed whitespace-pre-wrap border-t pt-6"></p>

            <div class="mt-12 bg-slate-100 p-6 rounded-lg">
                <h3 class="text-lg font-bold mb-4">解決策を提案する（開発者向け）</h3>
                <p class="text-sm text-slate-500 mb-4">※この機能は現在準備中です。GitHub連携URLなどを活用してください。</p>
                <div id="github-area" class="hidden">
                    <p class="text-sm font-medium mb-2">GitHub URL:</p>
                    <a id="github-link" href="#" target="_blank" class="text-blue-600 break-all hover:underline"></a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const issueId = urlParams.get('id');

        if (!issueId) {
            alert('課題IDが指定されていません');
            location.href = 'index.html';
        }

        async function fetchDetail() {
            // 現状は一覧取得APIから該当するIDを探す簡易実装
            try {
                const res = await fetch('/api/list-issues');
                const data = await res.json();
                const issue = data.find(i => i.id == issueId);

                if (!issue) {
                    alert('課題が見つかりませんでした');
                    location.href = 'index.html';
                    return;
                }

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('detail-content').classList.remove('hidden');

                document.getElementById('title').innerText = issue.title;
                document.getElementById('description').innerText = issue.description;

                const badge = document.getElementById('status-badge');
                badge.innerText = issue.status || 'open';

                // ステータスに応じた色分け
                if (issue.status === 'open') {
                    badge.classList.add('bg-blue-100', 'text-blue-700');
                } else if (issue.status === 'progress') {
                    badge.classList.add('bg-amber-100', 'text-amber-700');
                } else if (issue.status === 'closed') {
                    badge.classList.add('bg-emerald-100', 'text-emerald-700');
                }

                if (issue.github_url) {
                    document.getElementById('github-area').classList.remove('hidden');
                    const link = document.getElementById('github-link');
                    link.href = issue.github_url;
                    link.innerText = issue.github_url;
                }

            } catch (err) {
                console.error(err);
                alert('データの読み込みに失敗しました');
            }
        }

        fetchDetail();
    </script>
</body>

</html>